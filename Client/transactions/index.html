
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../invoices/">
      
      
        <link rel="next" href="../../layout/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>Transactions - InfyInvoices</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#transactions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="InfyInvoices" class="md-header__button md-logo" aria-label="InfyInvoices" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            InfyInvoices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Transactions
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../Login/" class="md-tabs__link">
      Authentication page
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Admin/dashboard/" class="md-tabs__link">
        Admin
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../dashboard/" class="md-tabs__link md-tabs__link--active">
        Client
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../layout/" class="md-tabs__link">
      Layout
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="InfyInvoices" class="md-nav__button md-logo" aria-label="InfyInvoices" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    InfyInvoices
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Login/" class="md-nav__link">
        Authentication page
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Admin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Admin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/dashboard/" class="md-nav__link">
        Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/admins/" class="md-nav__link">
        admins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/clients/" class="md-nav__link">
        clients
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/categories/" class="md-nav__link">
        categories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Taxes/" class="md-nav__link">
        Taxes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Products/" class="md-nav__link">
        Products
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Quotes/" class="md-nav__link">
        Quotes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/invoices/" class="md-nav__link">
        invoices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Transactions/" class="md-nav__link">
        Transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Payments/" class="md-nav__link">
        Payments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/InvoiceTemplates/" class="md-nav__link">
        Invoice Templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Admin/Settings/" class="md-nav__link">
        Settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard/" class="md-nav__link">
        Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quotes/" class="md-nav__link">
        Quotes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../invoices/" class="md-nav__link">
        Invoices
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Transactions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Transactions
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#route" class="md-nav__link">
    Route
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#invoice-model" class="md-nav__link">
    Invoice Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payment-model" class="md-nav__link">
    Payment Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-model" class="md-nav__link">
    Role Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#view" class="md-nav__link">
    View
  </a>
  
    <nav class="md-nav" aria-label="View">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-livewire-transactions-table" class="md-nav__link">
    The livewire: Transactions table
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list-of-transactions" class="md-nav__link">
    List of Transactions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../layout/" class="md-nav__link">
        Layout
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="transactions">Transactions</h1>
<h2 id="route">Route</h2>
<p>The route that leads to client's transactions is:</p>
<div class="highlight"><pre><span></span><code><span class="x">Route::get(&#39;transactions&#39;, [Client\PaymentController::class, &#39;index&#39;])-&gt;name(&#39;client.transactions.index&#39;);</span>
</code></pre></div>
<h2 id="controller">Controller</h2>
<p>The controller of the 'Transactions' page located in <strong>app&gt;http&gt;controllers&gt;PaymentController.php</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Exports\AdminTransactionsExport</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Invoice</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Payment</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Role</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Barryvdh\DomPDF\Facade</span> <span class="k">as</span> <span class="nx">PDF</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Foundation\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\View\Factory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\View\View</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\JsonResponse</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laracasts\Flash\Flash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Maatwebsite\Excel\Facades\Excel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\BinaryFileResponse</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PaymentController</span> <span class="k">extends</span> <span class="nx">AppBaseController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @return Application|Factory|View</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span><span class="o">:</span> <span class="nx">View</span><span class="o">|</span><span class="nx">Factory</span><span class="o">|</span><span class="nx">Application</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;transactions.index&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return BinaryFileResponse</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exportTransactionsExcel</span><span class="p">()</span><span class="o">:</span> <span class="nx">BinaryFileResponse</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Excel</span><span class="o">::</span><span class="na">download</span><span class="p">(</span><span class="k">new</span> <span class="nx">AdminTransactionsExport</span><span class="p">(),</span> <span class="s1">&#39;transaction.xlsx&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $id</span>
<span class="sd">     * @return JsonResponse</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">showPaymentNotes</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span><span class="o">:</span> <span class="nx">JsonResponse</span>
    <span class="p">{</span>
        <span class="nv">$paymentNotes</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sendResponse</span><span class="p">(</span><span class="nv">$paymentNotes</span><span class="o">-&gt;</span><span class="na">notes</span><span class="p">,</span> <span class="s1">&#39;Note retrieved successfully.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  Request  $request</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">changeTransactionStatus</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">mixed</span>
    <span class="p">{</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

        <span class="sd">/** @var Payment $payment */</span>
        <span class="nv">$payment</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">whereId</span><span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">wherePaymentMode</span><span class="p">(</span><span class="nx">Payment</span><span class="o">::</span><span class="na">MANUAL</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;invoice&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">firstOrFail</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">MANUAL</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
                <span class="s1">&#39;is_approved&#39;</span> <span class="o">=&gt;</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span>
            <span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updatePayment</span><span class="p">(</span><span class="nv">$payment</span><span class="p">);</span>

            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sendSuccess</span><span class="p">(</span><span class="s1">&#39;Manual Payment Approved successfully.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
            <span class="s1">&#39;is_approved&#39;</span> <span class="o">=&gt;</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">],</span>
        <span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">updatePayment</span><span class="p">(</span><span class="nv">$payment</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">sendSuccess</span><span class="p">(</span><span class="s1">&#39;Manual Payment Denied successfully.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param  Payment  $payment</span>
<span class="sd">     * @return void</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">updatePayment</span><span class="p">(</span><span class="nx">Payment</span> <span class="nv">$payment</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$paymentInvoice</span> <span class="o">=</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">invoice</span><span class="p">;</span>
        <span class="nv">$totalPayment</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">whereInvoiceId</span><span class="p">(</span><span class="nv">$paymentInvoice</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">whereIsApproved</span><span class="p">(</span><span class="nx">Payment</span><span class="o">::</span><span class="na">APPROVED</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">sum</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">);</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="nx">Invoice</span><span class="o">::</span><span class="na">PARTIALLY</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">amount</span> <span class="o">==</span> <span class="nv">$paymentInvoice</span><span class="o">-&gt;</span><span class="na">final_amount</span> <span class="o">||</span> <span class="nv">$totalPayment</span> <span class="o">==</span> <span class="nv">$paymentInvoice</span><span class="o">-&gt;</span><span class="na">final_amount</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$status</span> <span class="o">=</span> <span class="nv">$payment</span><span class="o">-&gt;</span><span class="na">is_approved</span> <span class="o">==</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">APPROVED</span> <span class="o">?</span> <span class="nx">Invoice</span><span class="o">::</span><span class="na">PAID</span> <span class="o">:</span> <span class="nx">Invoice</span><span class="o">::</span><span class="na">UNPAID</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$totalPayment</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$status</span> <span class="o">=</span> <span class="nx">Invoice</span><span class="o">::</span><span class="na">UNPAID</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$paymentInvoice</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$status</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">downloadAttachment</span><span class="p">(</span><span class="nv">$transactionId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="sd">/** @var Payment $transaction */</span>
        <span class="nv">$transaction</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;media&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$transactionId</span><span class="p">);</span>
        <span class="nv">$attachment</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">media</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">getLogInUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasrole</span><span class="p">(</span><span class="nx">Role</span><span class="o">::</span><span class="na">CLIENT</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">invoice</span><span class="o">-&gt;</span><span class="na">client</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">!==</span> <span class="nx">getLogInUserId</span><span class="p">())</span> <span class="p">{</span>
                <span class="nx">Flash</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Seems, you are not allowed to access this record.&#39;</span><span class="p">);</span>

                <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">back</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$attachment</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$attachment</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return Response</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">exportTransactionsPdf</span><span class="p">()</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;max_execution_time&#39;</span><span class="p">,</span> <span class="mi">36000000</span><span class="p">);</span>
        <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;payments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">with</span><span class="p">([</span><span class="s1">&#39;invoice.client.user&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
        <span class="nv">$transactionsPdf</span> <span class="o">=</span> <span class="nx">PDF</span><span class="o">::</span><span class="na">loadView</span><span class="p">(</span><span class="s1">&#39;transactions.export_transactions_pdf&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$transactionsPdf</span><span class="o">-&gt;</span><span class="na">download</span><span class="p">(</span><span class="s1">&#39;Transactions.pdf&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This is a PHP class called <code>PaymentController</code> in our application. It is a controller responsible for handling various actions related to payments and transactions. Let's break down the key methods and functionality in this controller:</p>
<ol>
<li>
<p><strong>Namespace and Imports</strong>:</p>
</li>
<li>
<p>The controller is in the <code>App\Http\Controllers</code> namespace.</p>
</li>
<li>
<p>It imports several classes and facades that are used within the controller, such as models, export, and PDF generation libraries.</p>
</li>
<li>
<p><strong>Index Method</strong>:</p>
</li>
<li>
<p>The <code>index</code> method is responsible for rendering a view named 'transactions.index'.</p>
</li>
<li>
<p><strong>Export Transactions Excel Method</strong>:</p>
</li>
<li>
<p>The <code>exportTransactionsExcel</code> method is used for exporting transactions to an Excel file using the Maatwebsite\Excel library.</p>
</li>
<li>
<p>It returns a <code>BinaryFileResponse</code>, typically triggering a file download when accessed.</p>
</li>
<li>
<p><strong>Show Payment Notes Method</strong>:</p>
</li>
<li>
<p>The <code>showPaymentNotes</code> method retrieves payment notes for a given payment ID.</p>
</li>
<li>
<p>It returns a JSON response with the payment notes and a success message.</p>
</li>
<li>
<p><strong>Change Transaction Status Method</strong>:</p>
</li>
<li>
<p>The <code>changeTransactionStatus</code> method updates the status of a payment transaction.</p>
</li>
<li>It accepts a POST request with an 'id' and 'status' parameter.</li>
<li>Depending on the 'status' parameter, it either approves or denies a manual payment and updates the payment accordingly.</li>
<li>
<p>It returns a success message as a JSON response.</p>
</li>
<li>
<p><strong>Update Payment Method</strong> (Private):</p>
</li>
<li>
<p>The <code>updatePayment</code> method is a private method used internally to update the status of an associated invoice based on the payment status.</p>
</li>
<li>
<p>It calculates the total payment for an invoice and updates the invoice status accordingly.</p>
</li>
<li>
<p><strong>Download Attachment Method</strong>:</p>
</li>
<li>
<p>The <code>downloadAttachment</code> method is used to download attachments associated with a payment transaction.</p>
</li>
<li>
<p>It checks permissions for accessing the attachment based on the user's role and returns the attachment file if it exists.</p>
</li>
<li>
<p><strong>Export Transactions PDF Method</strong>:</p>
</li>
<li>The <code>exportTransactionsPdf</code> method generates a PDF document containing payment transactions using the DomPDF library.</li>
<li>It sets a longer execution time to accommodate potentially large PDF generation.</li>
<li>It loads the data into a PDF view named 'transactions.export_transactions_pdf' and triggers a PDF download.</li>
</ol>
<p>Overall, this controller handles various tasks related to payment transactions, including exporting transactions to Excel and PDF, changing transaction statuses, and managing attachments associated with transactions. It integrates with Laravel's features and libraries to perform these actions efficiently.</p>
<h2 id="model">Model</h2>
<p>The models related to this controller are :<strong>App\Models\Invoice</strong> , <strong>App\Models\Payment</strong> and <strong>App\Models\Role</strong> .</p>
<h3 id="invoice-model">Invoice Model</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Carbon\Carbon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Collection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\BelongsTo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\BelongsToMany</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\HasMany</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Invoice</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">SELECT_DISCOUNT_TYPE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">FIXED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PERCENTAGE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">DISCOUNT_TYPE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">SELECT_DISCOUNT_TYPE</span> <span class="o">=&gt;</span> <span class="s1">&#39;Select Discount Type&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">FIXED</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fixed&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PERCENTAGE</span> <span class="o">=&gt;</span> <span class="s1">&#39;Percentage&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">DRAFT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">UNPAID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PAID</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PARTIALLY</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">OVERDUE</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">STATUS_ALL</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PROCESSING</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">STATUS_ARR</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATUS_ALL</span> <span class="o">=&gt;</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">DRAFT</span> <span class="o">=&gt;</span> <span class="s1">&#39;Draft&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">UNPAID</span> <span class="o">=&gt;</span> <span class="s1">&#39;Unpaid&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PAID</span> <span class="o">=&gt;</span> <span class="s1">&#39;Paid&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PARTIALLY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Partially Paid&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">OVERDUE</span> <span class="o">=&gt;</span> <span class="s1">&#39;Overdue&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PROCESSING</span> <span class="o">=&gt;</span> <span class="s1">&#39;Processing&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">RECURRING_OFF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">RECURRING_ON</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">RECURRING_STATUS_ARR</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">RECURRING_ON</span> <span class="o">=&gt;</span> <span class="s1">&#39;On&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">RECURRING_OFF</span> <span class="o">=&gt;</span> <span class="s1">&#39;Off&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">MONTHLY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">QUARTERLY</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">SEMIANNUALLY</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">ANNUALLY</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">RECURRING_ARR</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">MONTHLY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Monthly&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">QUARTERLY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Quarterly&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">SEMIANNUALLY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Semi Annually&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ANNUALLY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Annually&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Validation rules</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nv">$rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|unique:invoices,invoice_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;due_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">static</span> <span class="nv">$messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;client_id.required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The Client field is required.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_date.required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The invoice date field is required.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;due_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The invoice Due date field is required.&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;invoices&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status_label&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;client_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;due_date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;currency_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span><span class="p">,</span>
        <span class="s1">&#39;discount_type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;discount&#39;</span><span class="p">,</span>
        <span class="s1">&#39;final_amount&#39;</span><span class="p">,</span>
        <span class="s1">&#39;note&#39;</span><span class="p">,</span>
        <span class="s1">&#39;term&#39;</span><span class="p">,</span>
        <span class="s1">&#39;template_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recurring_status&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recurring_cycle&#39;</span><span class="p">,</span>
        <span class="s1">&#39;last_recurring_on&#39;</span><span class="p">,</span>
        <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;due_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invoice_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;currency_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
        <span class="s1">&#39;discount_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;discount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
        <span class="s1">&#39;final_amount&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
        <span class="s1">&#39;note&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;term&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;template_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recurring_status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;recurring_cycle&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;last_recurring_on&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tax&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getStatusLabelAttribute</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">STATUS_ARR</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return BelongsTo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">client</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsTo</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Client</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;client_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return HasMany</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">invoiceItems</span><span class="p">()</span><span class="o">:</span> <span class="nx">HasMany</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">InvoiceItem</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">generateUniqueInvoiceId</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="nv">$invoiceId</span> <span class="o">=</span> <span class="nb">mb_strtoupper</span><span class="p">(</span><span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$isExist</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">whereInvoiceId</span><span class="p">(</span><span class="nv">$invoiceId</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$isExist</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="o">::</span><span class="na">generateUniqueInvoiceId</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$invoiceId</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return HasMany</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">payments</span><span class="p">()</span><span class="o">:</span> <span class="nx">HasMany</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">Payment</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;invoice_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return HasMany</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">AdminPayment</span><span class="p">()</span><span class="o">:</span> <span class="nx">HasMany</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">AdminPayment</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;invoice_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return BelongsTo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">invoiceTemplate</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsTo</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">InvoiceSetting</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;template_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">parentInvoice</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsTo</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">childInvoices</span><span class="p">()</span><span class="o">:</span> <span class="nx">HasMany</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $value</span>
<span class="sd">     * @return Setting|mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getCurrencyIdAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">Currency</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">pluck</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">Currency</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">getSettingValue</span><span class="p">(</span><span class="s1">&#39;current_currency&#39;</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">pluck</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $value</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setInvoiceDateAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;invoice_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="nx">currentDateFormat</span><span class="p">(),</span>
            <span class="nv">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">translatedFormat</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $value</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDueDateAttribute</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">attributes</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Carbon</span><span class="o">::</span><span class="na">createFromFormat</span><span class="p">(</span><span class="nx">currentDateFormat</span><span class="p">(),</span>
            <span class="nv">$value</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">translatedFormat</span><span class="p">(</span><span class="s1">&#39;Y-m-d&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return BelongsToMany</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">invoiceTaxes</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsToMany</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsToMany</span><span class="p">(</span><span class="nx">Tax</span><span class="o">::</span><span class="na">class</span><span class="p">,</span><span class="s1">&#39;invoice_taxes&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The provided code represents a Laravel Eloquent model named <code>Invoice</code>. This model is used to interact with the 'invoices' database table and represents various attributes and behaviors related to invoices. Let's break down the key aspects of this <code>Invoice</code> model:</p>
<ol>
<li>
<p><strong>Namespace</strong>: The model is defined within the <code>App\Models</code> namespace, which is a standard Laravel convention for organizing models.</p>
</li>
<li>
<p><strong>Extends Model</strong>: This model class extends <code>Illuminate\Database\Eloquent\Model</code>, which means it inherits various features and functionalities from the Eloquent model class.</p>
</li>
<li>
<p><strong>Use of HasFactory Trait</strong>: The <code>HasFactory</code> trait is included in this model. It's used to enable Laravel's factory support, allowing you to easily create model instances for testing or seeding the database.</p>
</li>
<li>
<p><strong>Constants</strong>: The model defines several constant values that represent different aspects of invoices, such as discount types, invoice statuses, recurring statuses, and recurring cycle options. These constants are used to provide meaningful labels and options for invoices.</p>
</li>
<li>
<p><strong>Validation Rules and Messages</strong>: The model defines validation rules and messages using the <code>$rules</code> and <code>$messages</code> static properties. These rules and messages are used for data validation when creating or updating invoice records.</p>
</li>
<li>
<p><strong>Table Name</strong>: The <code>public $table</code> property is set to 'invoices', indicating that this model is associated with the 'invoices' database table.</p>
</li>
<li>
<p><strong>Appends Attribute</strong>: The <code>public $appends</code> property is an array that defines additional attributes that should be included when converting the model to an array or JSON. In this case, it includes a 'status_label' attribute.</p>
</li>
<li>
<p><strong>Fillable Attributes</strong>: The <code>public $fillable</code> property is an array that lists the attributes of the model that are allowed to be mass-assigned. Mass assignment is commonly used when creating or updating records. In this case, it allows mass assignment for various invoice-related attributes.</p>
</li>
<li>
<p><strong>Attribute Casting</strong>: The <code>protected $casts</code> property is an array that defines the data types to which specific attributes should be cast when retrieving them from the database. It ensures that attributes like dates and numeric values are cast to their appropriate data types.</p>
</li>
<li>
<p><strong>Accessors and Mutators</strong>: The model defines accessor methods (<code>getCurrencyIdAttribute</code>, <code>getStatusLabelAttribute</code>) and mutator methods (<code>setInvoiceDateAttribute</code>, <code>setDueDateAttribute</code>) to customize the behavior of attribute access and assignment.</p>
</li>
<li>
<p><strong>Relationships</strong>: The model defines several relationships with other Eloquent models, including:</p>
<ul>
<li><code>client()</code>: Belongs to a <code>Client</code> model.</li>
<li><code>invoiceItems()</code>: Has many <code>InvoiceItem</code> models.</li>
<li><code>payments()</code>: Has many <code>Payment</code> models.</li>
<li><code>AdminPayment()</code>: Has many <code>AdminPayment</code> models.</li>
<li><code>invoiceTemplate()</code>: Belongs to an <code>InvoiceSetting</code> model.</li>
<li><code>parentInvoice()</code>: Belongs to another <code>Invoice</code> model as a parent invoice.</li>
<li><code>childInvoices()</code>: Has many <code>Invoice</code> models as child invoices.</li>
<li><code>invoiceTaxes()</code>: Belongs to many <code>Tax</code> models through the 'invoice_taxes' pivot table.</li>
</ul>
</li>
<li>
<p><strong>Custom Methods</strong>: The model defines custom methods like <code>generateUniqueInvoiceId</code> to generate unique invoice IDs and <code>setInvoiceDateAttribute</code> and <code>setDueDateAttribute</code> to format date attributes.</p>
</li>
</ol>
<h3 id="payment-model">Payment Model</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Barryvdh\LaravelIdeHelper\Eloquent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\BelongsTo</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Carbon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\MediaLibrary\HasMedia</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\MediaLibrary\InteractsWithMedia</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\MediaLibrary\MediaCollections\Models\Media</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Payment</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="k">implements</span> <span class="nx">HasMedia</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">,</span> <span class="nx">InteractsWithMedia</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;payments&#39;</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;invoice_id&#39;</span><span class="p">,</span> <span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_date&#39;</span><span class="p">,</span> <span class="s1">&#39;payment_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;transaction_id&#39;</span><span class="p">,</span> <span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;is_approved&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;invoice_id&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span>         <span class="o">=&gt;</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span>
        <span class="s1">&#39;payment_date&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;payment_mode&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;transaction_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;meta&#39;</span>           <span class="o">=&gt;</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
        <span class="s1">&#39;notes&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;user_id&#39;</span>        <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;is_approved&#39;</span>    <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="nv">$appends</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;payments_mode&#39;</span><span class="p">];</span>

    <span class="k">const</span> <span class="no">PAYMENT_ATTACHMENT</span> <span class="o">=</span> <span class="s1">&#39;payment_attachment&#39;</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">FULLPAYMENT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">PARTIALLYPAYMENT</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">PAYMENT_TYPE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">FULLPAYMENT</span>      <span class="o">=&gt;</span> <span class="s1">&#39;Full Payment&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PARTIALLYPAYMENT</span> <span class="o">=&gt;</span> <span class="s1">&#39;Partially Payment&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">const</span> <span class="no">PENDING</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">APPROVED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">REJECTED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATUS_ALL</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">PAID</span> <span class="o">=</span> <span class="s1">&#39;Paid&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">PROCESSING</span> <span class="o">=</span> <span class="s1">&#39;Processing&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">DENIED</span> <span class="o">=</span> <span class="s1">&#39;Denied&#39;</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STATUS_ARR_ALL</span> <span class="o">=</span> <span class="s1">&#39;All&#39;</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">PAYMENT_STATUS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STATUS_ALL</span> <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">STATUS_ARR_ALL</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PENDING</span>    <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">PROCESSING</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">APPROVED</span>   <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">PAID</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">REJECTED</span>   <span class="o">=&gt;</span> <span class="nx">self</span><span class="o">::</span><span class="na">DENIED</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">const</span> <span class="no">STATUS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;RECEIVED_AMOUNT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Received Amount&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PAID_AMOUNT&#39;</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Paid Amount&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DUE_AMOUNT&#39;</span>      <span class="o">=&gt;</span> <span class="s1">&#39;Due Amount&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">const</span> <span class="no">MANUAL</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">STRIPE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">PAYPAL</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">CASH</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">RAZORPAY</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">ALL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">PAYMENT_MODE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">ALL</span>      <span class="o">=&gt;</span> <span class="s1">&#39;All&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">MANUAL</span>   <span class="o">=&gt;</span> <span class="s1">&#39;Manual&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">STRIPE</span>   <span class="o">=&gt;</span> <span class="s1">&#39;Stripe&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">PAYPAL</span>   <span class="o">=&gt;</span> <span class="s1">&#39;Paypal&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">CASH</span>     <span class="o">=&gt;</span> <span class="s1">&#39;Cash&#39;</span><span class="p">,</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">RAZORPAY</span> <span class="o">=&gt;</span> <span class="s1">&#39;Razorpay&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">static</span> <span class="nv">$rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;payment_type&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;amount&#39;</span>             <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;payment_mode&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;payment_attachment&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;nullable|mimes:pdf,png,jpeg,jpg&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPaymentAttachmentAttribute</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="sd">/** @var Media $media */</span>
        <span class="nv">$media</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMedia</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">PAYMENT_ATTACHMENT</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$media</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$media</span><span class="o">-&gt;</span><span class="na">getFullUrl</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPaymentTypeAttribute</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">PAYMENT_MODE</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">payment_mode</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return string</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPaymentsModeAttribute</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">PAYMENT_MODE</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">payment_mode</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @return BelongsTo</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">invoice</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsTo</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">Invoice</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The provided code represents a Laravel Eloquent model named <code>Payment</code>. This model is used to interact with the 'payments' database table and represents various attributes and behaviors related to payments. Let's break down the key aspects of this <code>Payment</code> model:</p>
<ol>
<li>
<p><strong>Namespace</strong>: The model is defined within the <code>App\Models</code> namespace, which is a standard Laravel convention for organizing models.</p>
</li>
<li>
<p><strong>Extends Model</strong>: This model class extends <code>Illuminate\Database\Eloquent\Model</code>, which means it inherits various features and functionalities from the Eloquent model class.</p>
</li>
<li>
<p><strong>Use of Traits</strong>: The <code>HasFactory</code> and <code>InteractsWithMedia</code> traits are included in this model.</p>
</li>
<li>
<p><code>HasFactory</code> is used to enable Laravel's factory support, allowing you to easily create model instances for testing or seeding the database.</p>
</li>
<li>
<p><code>InteractsWithMedia</code> is used to integrate the model with the Spatie Media Library, which allows you to associate media files (such as payment attachments) with the model.</p>
</li>
<li>
<p><strong>Table Name</strong>: The <code>protected $table</code> property is set to 'payments', indicating that this model is associated with the 'payments' database table.</p>
</li>
<li>
<p><strong>Fillable Attributes</strong>: The <code>protected $fillable</code> property is an array that lists the attributes of the model that are allowed to be mass-assigned. Mass assignment is commonly used when creating or updating records. In this case, it allows mass assignment for various payment-related attributes such as 'invoice_id,' 'amount,' 'payment_date,' 'payment_mode,' 'transaction_id,' 'notes,' and 'is_approved.'</p>
</li>
<li>
<p><strong>Attribute Casting</strong>: The <code>protected $casts</code> property is an array that defines the data types to which specific attributes should be cast when retrieving them from the database. It ensures that attributes like dates, numbers, and JSON fields are cast to their appropriate data types.</p>
</li>
<li>
<p><strong>Appends Attribute</strong>: The <code>public $appends</code> property is an array that defines additional attributes that should be included when converting the model to an array or JSON. In this case, it includes a 'payments_mode' attribute.</p>
</li>
<li>
<p><strong>Constants</strong>: The model defines constant values that represent different aspects of payments, including payment types, payment statuses, and payment modes.</p>
</li>
<li>
<p><strong>Validation Rules</strong>: The model defines validation rules using the <code>$rules</code> static property. These rules are used for data validation when creating or updating payment records.</p>
</li>
<li>
<p><strong>Custom Accessors</strong>: The model defines custom accessor methods (<code>getPaymentAttachmentAttribute</code>, <code>getPaymentTypeAttribute</code>, <code>getPaymentsModeAttribute</code>) to customize the behavior of attribute access. These accessors provide formatted URLs for payment attachments and human-readable labels for payment type and mode.</p>
</li>
<li>
<p><strong>Relationships</strong>: The model defines a relationship with the <code>Invoice</code> model using the <code>invoice()</code> method, indicating that a payment belongs to an invoice.</p>
</li>
</ol>
<p>Overall, the <code>Payment</code> model provides the structure and functionality to work with payment data in our application. It allows you to associate payments with invoices, manage payment attributes, and interact with media attachments associated with payments.</p>
<h3 id="role-model">Role Model</h3>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Database\Factories\RoleFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Eloquent</span> <span class="k">as</span> <span class="nx">Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Collection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Carbon</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Spatie\Permission\Models\Role</span> <span class="k">as</span> <span class="nx">roleModal</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Role</span> <span class="k">extends</span> <span class="nx">roleModal</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;roles&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">ADMIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">const</span> <span class="no">CLIENT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">ROLE_ADMIN</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">ROLE_CLIENT</span> <span class="o">=</span> <span class="s1">&#39;client&#39;</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;display_name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;is_default&#39;</span><span class="p">,</span>
        <span class="s1">&#39;permission_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;guard_name&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;display_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
        <span class="s1">&#39;is_default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;guard_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">static</span> <span class="nv">$rules</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;display_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="s1">&#39;permission_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>The provided code defines a Laravel model class called <code>Role</code>, which extends the <code>Spatie\Permission\Models\Role</code> model. It is a custom extension of the Spatie Permission package's Role model. Here's an explanation of the key elements within this <code>Role</code> model:</p>
<ol>
<li>
<p><strong>Namespace and Imports</strong>:</p>
</li>
<li>
<p>The model is in the <code>App\Models</code> namespace.</p>
</li>
<li>
<p>It imports the necessary classes, including <code>Model</code> and <code>HasFactory</code>.</p>
</li>
<li>
<p><strong>Use of HasFactory</strong>:</p>
</li>
<li>
<p>The <code>HasFactory</code> trait is used, indicating that this model can be used with factory classes for database seeding and testing.</p>
</li>
<li>
<p><strong>Table Name</strong>:</p>
</li>
<li>
<p>The protected property <code>$table</code> specifies the name of the database table associated with this model. In this case, it's set to <code>'roles'</code>.</p>
</li>
<li>
<p><strong>Constants for Role Types</strong>:</p>
</li>
<li>
<p>Two constants, <code>ADMIN</code> and <code>CLIENT</code>, are defined, each with an integer value.</p>
</li>
<li>
<p>These constants represent different role types within the application, such as administrator and client roles.</p>
</li>
<li>
<p><strong>Role Names</strong>:</p>
</li>
<li>
<p>Two constants, <code>ROLE_ADMIN</code> and <code>ROLE_CLIENT</code>, are defined, each representing the display name for a role.</p>
</li>
<li>
<p>These constants are used for displaying the role names in the application.</p>
</li>
<li>
<p><strong>Fillable Attributes</strong>:</p>
</li>
<li>
<p>The <code>protected $fillable</code> property lists the attributes that can be mass-assigned when creating or updating a <code>Role</code> model.</p>
</li>
<li>
<p>Attributes include 'name', 'display_name', 'is_default', 'permission_id', and 'guard_name'.</p>
</li>
<li>
<p><strong>Attribute Type Casting</strong>:</p>
</li>
<li>
<p>The <code>protected $casts</code> property specifies the data types to which certain attributes should be cast.</p>
</li>
<li>
<p>For example, 'is_default' is cast to an integer, and 'name' and 'display_name' are cast to strings.</p>
</li>
<li>
<p><strong>Validation Rules</strong>:</p>
</li>
<li>The <code>public static $rules</code> property defines validation rules for creating or updating a <code>Role</code> model.</li>
<li>It requires that 'display_name' and 'permission_id' attributes are provided.</li>
</ol>
<p>This <code>Role</code> model is tailored for managing user roles within the application. It extends the Spatie Permission package's Role model to provide additional functionality and customization specific to the application's requirements.</p>
<h2 id="view">View</h2>
<h3 id="the-livewire-transactions-table">The livewire: Transactions table</h3>
<p>The livewire of the 'client transactions table' located in <strong>app&gt;http&gt;livewire&gt;ClientTransactionTable.php</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Livewire</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Payment</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Rappasoft\LaravelLivewireTables\Views\Column</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ClientTransactionTable</span> <span class="k">extends</span> <span class="nx">LivewireTableComponent</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$model</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nx">string</span> <span class="nv">$tableName</span> <span class="o">=</span> <span class="s1">&#39;payments&#39;</span><span class="p">;</span>

    <span class="c1">// for table header button</span>
    <span class="k">public</span> <span class="nv">$showButtonOnHeader</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$buttonComponent</span> <span class="o">=</span> <span class="s1">&#39;client_panel.transactions.components.export-button&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="nx">bool</span> <span class="nv">$showFilterOnHeader</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$filterComponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;transactions.components.filter-button&#39;</span><span class="p">,</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">PAYMENT_MODE</span><span class="p">,</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">PAYMENT_STATUS</span><span class="p">];</span>
    <span class="k">protected</span> <span class="nv">$listeners</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;changePaymentModeFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;changePaymentStatusFilter&#39;</span><span class="p">,</span> <span class="s1">&#39;resetPageTable&#39;</span><span class="p">];</span>
    <span class="k">public</span> <span class="nv">$paymentModeFilter</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">ALL</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$paymentStatusFilter</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">STATUS_ALL</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configure</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setPrimaryKey</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setDefaultSort</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;desc&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setQueryStringStatus</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setThAttributes</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Column</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isField</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;d-flex justify-content-end&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isField</span><span class="p">(</span><span class="s1">&#39;payment_mode&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text-center&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">isField</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text-center&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">[</span>
            <span class="p">];</span>
        <span class="p">});</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setTdAttributes</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Column</span> <span class="nv">$column</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nv">$columnIndex</span><span class="p">,</span> <span class="nv">$rowIndex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;payment_mode&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text-center&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;invoice_id&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;w-25&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;payment_date&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;w-35&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">(),</span> <span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text-end w-35&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$column</span><span class="o">-&gt;</span><span class="na">getField</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text-center&#39;</span><span class="p">,</span>
                <span class="p">];</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="p">[</span>
            <span class="p">];</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">columns</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.invoice.invoice_id&#39;</span><span class="p">),</span> <span class="s1">&#39;invoice.invoice_id&#39;</span><span class="p">)</span>
<span class="c1">//                -&gt;sortable()</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nx">Column</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;transactions.components.invoice-id-payment-date&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withValue</span><span class="p">([</span>
                            <span class="s1">&#39;invoice-id-route&#39;</span> <span class="o">=&gt;</span> <span class="nx">route</span><span class="p">(</span><span class="s1">&#39;client.invoices.show&#39;</span><span class="p">,</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">invoice</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">),</span>
                            <span class="s1">&#39;invoice-id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">invoice</span><span class="o">-&gt;</span><span class="na">invoice_id</span><span class="p">,</span>
                        <span class="p">]);</span>
                <span class="p">}),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="s1">&#39;Last Name&#39;</span><span class="p">,</span> <span class="s1">&#39;invoice.client.user.last_name&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">sortable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">hideif</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.payment.payment_date&#39;</span><span class="p">),</span> <span class="s1">&#39;payment_date&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">sortable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nx">Column</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;transactions.components.invoice-id-payment-date&#39;</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">withValue</span><span class="p">([</span>
                            <span class="s1">&#39;payment-date&#39;</span> <span class="o">=&gt;</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">payment_date</span><span class="p">,</span>
                        <span class="p">]);</span>
                <span class="p">}),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.invoice.amount&#39;</span><span class="p">),</span> <span class="s1">&#39;amount&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">sortable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$row</span><span class="p">,</span> <span class="nx">Column</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">getInvoiceCurrencyAmount</span><span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">amount</span><span class="p">,</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">invoice</span><span class="o">-&gt;</span><span class="na">currency_id</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="p">}),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.invoice.payment_method&#39;</span><span class="p">),</span> <span class="s1">&#39;payment_mode&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;transactions.components.payment-mode&#39;</span><span class="p">),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.common.status&#39;</span><span class="p">),</span> <span class="s1">&#39;payment_mode&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;transactions.components.transaction-status&#39;</span><span class="p">),</span>
            <span class="nx">Column</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nx">__</span><span class="p">(</span><span class="s1">&#39;messages.common.attachment&#39;</span><span class="p">),</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">searchable</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;transactions.components.transaction-attachment&#39;</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">builder</span><span class="p">()</span><span class="o">:</span> <span class="nx">Builder</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;invoice.client.user&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">whereHas</span><span class="p">(</span><span class="s1">&#39;invoice.client&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="nx">Auth</span><span class="o">::</span><span class="na">id</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;payments.*&#39;</span><span class="p">);</span>

        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">when</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentModeFilter</span><span class="p">),</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentModeFilter</span> <span class="o">!=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">ALL</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;payment_mode&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentModeFilter</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">when</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentStatusFilter</span><span class="p">),</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentStatusFilter</span> <span class="o">!=</span> <span class="nx">Payment</span><span class="o">::</span><span class="na">STATUS_ALL</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;is_approved&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentStatusFilter</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nv">$query</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $mode</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">changePaymentModeFilter</span><span class="p">(</span><span class="nv">$mode</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resetPage</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getComputedPageName</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentModeFilter</span> <span class="o">=</span> <span class="nv">$mode</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setBuilder</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">builder</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param $status</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">changePaymentStatusFilter</span><span class="p">(</span><span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resetPage</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getComputedPageName</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentStatusFilter</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setBuilder</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">builder</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The provided PHP code is a Livewire component in our application, responsible for managing and rendering a table of client transactions within the client panel. Here's an explanation of the key aspects of this Livewire component:</p>
<ol>
<li>
<p><strong>Model and Table Name:</strong></p>
</li>
<li>
<p>The <code>protected $model</code> property is set to <code>Payment::class</code>, indicating that this Livewire component is associated with the <code>Payment</code> model.</p>
</li>
<li>
<p>The <code>protected string $tableName</code> property is set to 'payments', specifying the name of the Livewire table component.</p>
</li>
<li>
<p><strong>Table Header Options:</strong></p>
</li>
<li>
<p><code>$showButtonOnHeader</code> and <code>$buttonComponent</code> are used to show a button in the table header. The button is specified by the <code>client_panel.transactions.components.export-button</code> Livewire component.</p>
</li>
<li>
<p><code>$showFilterOnHeader</code> and <code>$filterComponent</code> are used to show filters in the table header. Filters are specified by the <code>transactions.components.filter-button</code> Livewire component, and two filter options are passed: <code>Payment::PAYMENT_MODE</code> and <code>Payment::PAYMENT_STATUS</code>.</p>
</li>
<li>
<p><strong>Event Listeners:</strong></p>
</li>
<li>
<p>The Livewire component defines event listeners for changes in payment mode and payment status filters, as well as resetting the page.</p>
</li>
<li>
<p><strong>Filter Properties:</strong></p>
</li>
<li>
<p><code>$paymentModeFilter</code> and <code>$paymentStatusFilter</code> store the selected payment mode and payment status filter values.</p>
</li>
<li>
<p><strong>Configuration:</strong></p>
</li>
<li>
<p>The <code>configure</code> method is used for configuration:</p>
<ul>
<li>It sets the primary key for the table to 'id'.</li>
<li>It specifies the default sorting by 'created_at' in descending order.</li>
<li>It disables the use of query string parameters for filtering.</li>
<li>It defines attributes for table header (<code>th</code>) and table data (<code>td</code>) columns.</li>
</ul>
</li>
<li>
<p><strong>Table Columns:</strong></p>
</li>
<li>
<p>The <code>columns</code> method defines the columns to be displayed in the table, including invoice ID, client last name, payment date, amount, payment method, transaction status, and attachment.</p>
</li>
<li>
<p><strong>Builder Method:</strong></p>
</li>
<li>
<p>The <code>builder</code> method defines the query builder used to retrieve transaction data based on the selected filters (payment mode and payment status).</p>
</li>
<li>It includes related data, such as the associated invoice, client, and user.</li>
<li>
<p>It filters transactions based on the selected payment mode and payment status.</p>
</li>
<li>
<p><strong>Filter Methods:</strong></p>
</li>
<li><code>changePaymentModeFilter</code> and <code>changePaymentStatusFilter</code> methods are used to change and apply the payment mode and payment status filters. They also reset the table page to the first page when filters are changed.</li>
</ol>
<p>Overall, this Livewire component provides a dynamic and interactive table for displaying client transactions in a client panel. Users can filter transactions by payment mode and payment status, and export data using the provided button.</p>
<h3 id="list-of-transactions">List of Transactions</h3>
<p>The list of transactions view is located in : <strong>resources\views\client_panel\Transactions\index.blade.php</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="x">@extends(&#39;client_panel.layouts.app&#39;)</span>
<span class="x">@section(&#39;title&#39;)</span>
<span class="x">    Transactions</span>
<span class="x">@endsection</span>
<span class="x">@section(&#39;content&#39;)</span>
<span class="x">    &lt;div class=&quot;container-fluid&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;d-flex flex-column &quot;&gt;</span>
<span class="x">            @include(&#39;flash::message&#39;)</span>
<span class="x">            &lt;livewire:client-transaction-table/&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    @include(&#39;transactions.payment-notes-modal&#39;)</span>
<span class="x">    {{ Form::hidden(&#39;currency&#39;, getCurrencySymbol() ,[&#39;id&#39; =&gt; &#39;currency&#39;]) }}</span>
<span class="x">@endsection</span>
</code></pre></div>
<p>The provided Blade template appears to be part of a Laravel application's client panel and is responsible for rendering a page to display transactions. Here's an explanation of the key components within this template:</p>
<ol>
<li>
<p><strong>Page Title and Content Section:</strong></p>
</li>
<li>
<p>The <code>@section('title')</code> directive sets the title of the page to "Transactions."</p>
</li>
<li>
<p><strong>Container and Content:</strong></p>
</li>
<li>
<p>The page content is wrapped within a <code>&lt;div&gt;</code> with the class <code>container-fluid</code>, providing a fluid container for the page layout.</p>
</li>
<li>
<p>Within this container, there's a <code>flex-column</code> layout, which typically arranges child elements vertically.</p>
</li>
<li>
<p><strong>Flash Messages:</strong></p>
</li>
<li>
<p><code>@include('flash::message')</code> is used to include flash messages. Flash messages are typically used to display notifications or alerts to users.</p>
</li>
<li>
<p><strong>Livewire Component:</strong></p>
</li>
<li>
<p><code>&lt;livewire:client-transaction-table/&gt;</code> includes a Livewire component called <code>client-transaction-table</code>. This component is responsible for rendering a table of transactions and handles filtering, sorting, and pagination of the transaction data.</p>
</li>
<li>
<p><strong>Payment Notes Modal:</strong></p>
</li>
<li>
<p><code>@include('transactions.payment-notes-modal')</code> includes a modal for displaying payment notes. Modals are often used to show additional information or allow user interactions without navigating away from the current page.</p>
</li>
<li>
<p><strong>Hidden Input for Currency:</strong></p>
</li>
<li><code>{{ Form::hidden('currency', getCurrencySymbol() ,['id' =&gt; 'currency']) }}</code> creates a hidden input field with the name "currency" and a value retrieved from the <code>getCurrencySymbol()</code> function. This hidden input used to store currency-related information on the page, possibly for JavaScript functionality.</li>
</ol>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>